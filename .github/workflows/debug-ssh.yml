name: Debug SSH

on: workflow_dispatch   # manual trigger

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Test SSH connection
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          debug: true               # ← enables verbose output!
          script: |
            whoami
            pwd
            echo "If you see this → connected successfully!"
      - name: Debug Key Format
        run: |
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > /tmp/key.txt
          if [ $(tail -c 1 /tmp/key.txt | wc -c) -eq 0 ]; then
            echo "Key ends with newline: Yes"
          else
            echo "Key ends with newline: No (this is the problem!)"
          fi
          od -c /tmp/key.txt | tail -n 5  # Check last lines for \r or missing \n
